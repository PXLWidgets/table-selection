{"version":3,"file":"table-selection.min.js","mappings":"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","sources":["webpack://TableSelection/webpack/universalModuleDefinition","webpack://TableSelection/webpack/bootstrap","webpack://TableSelection/webpack/runtime/define property getters","webpack://TableSelection/webpack/runtime/hasOwnProperty shorthand","webpack://TableSelection/./src/index.ts","webpack://TableSelection/./src/TableSelection.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TableSelection\"] = factory();\n\telse\n\t\troot[\"TableSelection\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/*!\n * TableSelection library v1.0.0 (https://github.com/PXLWidgets/table-selection)\n * Copyright (c) 2019 Wouter Smit\n * Licensed under MIT (https://github.com/PXLWidgets/table-selection/blob/master/LICENSE)\n*/\n\nimport { TableSelection } from './TableSelection';\n\nexport default TableSelection;\n","/*!\n * TableSelection library v1.0.0 (https://github.com/PXLWidgets/table-selection)\n * Copyright (c) 2019 Wouter Smit\n * Licensed under MIT (https://github.com/PXLWidgets/table-selection/blob/master/LICENSE)\n*/\n\nimport { TableSelectionConfig } from './interfaces/TableSelectionConfig';\nimport { TableSelectionRange } from './interfaces/TableSelectionRange';\nimport { TableSelectionTableElements } from './interfaces/TableSelectionTableElements';\n\nexport class TableSelection {\n\n    config: TableSelectionConfig = {\n        selector: '.table-selection',\n        selectionCssMode: 'style',\n        selectionCssClass: 'selected',\n    };\n\n    range: TableSelectionRange | null = null;\n    elements: TableSelectionTableElements;\n\n    constructor(config: TableSelectionConfig = {}) {\n        this.config = { ...this.config, ...config };\n\n        // Hide default selection\n        const styles = document.createElement('style');\n        styles.innerHTML = `${this.config.selector} *::selection {\n            background: transparent;\n            color: inherit;\n        }`;\n        document.head.appendChild(styles);\n\n        document.addEventListener('selectionchange', () => this.onSelectionChange());\n        document.addEventListener('copy', (e) => this.copyToClipboard(e));\n    }\n\n    protected onSelectionChange(): void {\n        const selection = getSelection();\n\n        this.deselect();\n        if (! selection || selection.isCollapsed) {\n            return;\n        }\n\n        const startCell: HTMLTableCellElement | null = this.getCellElementFromNode(selection.anchorNode);\n        const endCell: HTMLTableCellElement | null = this.getCellElementFromNode(selection.focusNode);\n        if (! startCell || ! endCell) {\n            return;\n        }\n\n        const startTableElements = this.getTableElementsFromCellElement(startCell);\n        const endTableElements = this.getTableElementsFromCellElement(endCell);\n        if (! startTableElements || ! endTableElements) {\n            return;\n        }\n\n        const isSameTable = startTableElements.table === endTableElements.table;\n        if (! isSameTable) {\n            return;\n        }\n\n        this.elements = startTableElements;\n\n        this.getRangeByStartAndEndElement(startCell, endCell);\n        this.getRowElements();\n        this.getRowsAndCells();\n\n        if (this.range) {\n            this.select();\n        } else {\n            this.deselect();\n        }\n    }\n\n    protected getRangeByStartAndEndElement(\n        startCellElement: HTMLTableCellElement,\n        endCellElement: HTMLTableCellElement,\n    ): void {\n\n        const startRowElement: HTMLTableRowElement | null = startCellElement.parentElement as HTMLTableRowElement;\n        const endRowElement: HTMLTableRowElement | null = endCellElement.parentElement as HTMLTableRowElement;\n\n        if (! startRowElement || ! endRowElement) {\n            return;\n        }\n\n        this.range = {\n            start: {\n                row: startRowElement.rowIndex + 1,\n                cell: startCellElement.cellIndex + 1,\n            },\n            end: {\n                row: endRowElement.rowIndex + 1,\n                cell: endCellElement.cellIndex + 1,\n            },\n            rowElements: [],\n            rows: [],\n            cells: [],\n        };\n\n        // Flip start/end if end > start\n        if (this.range.start.cell > this.range.end.cell) {\n            [this.range.start.cell, this.range.end.cell] = [this.range.end.cell, this.range.start.cell];\n        }\n        if (this.range.start.row > this.range.end.row) {\n            [this.range.start.row, this.range.end.row] = [this.range.end.row, this.range.start.row];\n        }\n    }\n\n    protected getRowElements(): void {\n        if (! this.range || ! this.elements.table) {\n            return;\n        }\n\n        const numTableHeaders = this.elements.table.querySelectorAll('thead tr').length;\n        let theadRows: HTMLTableRowElement[] = [];\n        let tbodyRows: HTMLTableRowElement[] = [];\n\n        const theadStart = this.range.start.row <= numTableHeaders\n            ? Math.min(numTableHeaders, this.range.start.row)\n            : null;\n        const theadEnd = this.range.start.row <= numTableHeaders\n            ? Math.min(numTableHeaders, this.range.end.row)\n            : null;\n\n        const tbodyStart = this.range.end.row > numTableHeaders\n            ? Math.max(1, this.range.start.row - numTableHeaders)\n            : null;\n        const tbodyEnd = this.range.end.row > numTableHeaders\n            ? Math.max(1, this.range.end.row - numTableHeaders)\n            : null;\n\n        if (theadStart) {\n            theadRows = Array.from(this.elements.table.querySelectorAll(\n                `thead tr:nth-of-type(n+${theadStart}):nth-of-type(-n+${theadEnd})`,\n            ));\n        }\n\n        if (tbodyStart) {\n            tbodyRows = Array.from(this.elements.table.querySelectorAll(\n                `tbody tr:nth-of-type(n+${tbodyStart}):nth-of-type(-n+${tbodyEnd})`,\n            ));\n        }\n\n        this.range.rowElements = [...theadRows, ...tbodyRows];\n    }\n\n    protected getRowsAndCells(): void {\n        if (! this.range || ! this.range.rowElements) {\n            return;\n        }\n\n        let cells: HTMLTableCellElement[] = [];\n        this.range.rowElements.forEach((row: HTMLTableRowElement, i: number) => {\n            if (! this.range) {\n                return;\n            }\n\n            const cellsInRow = Array.from(row.querySelectorAll(\n                [\n                    `td:nth-of-type(n+${this.range.start.cell}):nth-of-type(-n+${this.range.end.cell})`,\n                    `th:nth-of-type(n+${this.range.start.cell}):nth-of-type(-n+${this.range.end.cell})`,\n                ].join(',')\n            )) as HTMLTableCellElement[];\n\n            cells = [...cells, ...cellsInRow];\n            this.range.rows[i] = cellsInRow;\n        });\n\n        this.range.cells = cells;\n\n    }\n\n    protected getCellElementFromNode(inputNode: Node | null): HTMLTableCellElement | null {\n        if (! inputNode) {\n            return null;\n        }\n\n        const element: HTMLTableCellElement | null = inputNode.nodeName === '#text'\n            ? (inputNode.parentElement as HTMLTableCellElement)\n            : (inputNode as HTMLTableCellElement);\n\n        if (! element || ! ['TD', 'TH'].includes(element.tagName)) {\n            return null;\n        }\n\n        return element;\n    }\n\n    protected getTableElementsFromCellElement(cellElement: HTMLTableCellElement): TableSelectionTableElements | null {\n        if (! cellElement || ! cellElement.parentElement || ! cellElement.parentElement.parentElement) {\n            return null;\n        }\n\n        const tHeadOrBody = cellElement.parentElement.parentElement;\n        const table: HTMLTableElement = ['TBODY', 'THEAD'].includes(tHeadOrBody.tagName)\n            ? (tHeadOrBody.parentElement as HTMLTableElement)\n            : (tHeadOrBody as HTMLTableElement);\n\n        if (! table || ! this.config.selector || ! table.matches(this.config.selector)) {\n            return null;\n        }\n\n        return {\n            table,\n            thead: table.querySelector('thead') as HTMLTableSectionElement,\n            tbody: table.querySelector('tbody') as HTMLTableSectionElement,\n        };\n    }\n\n    protected select(): void {\n        if (this.range && this.range.cells) {\n            this.range.cells.forEach((cellElement) => {\n                if (this.config.selectionCssMode === 'cssClass' && this.config.selectionCssClass) {\n                    cellElement.classList.add(this.config.selectionCssClass);\n                } else {\n                    cellElement.style.backgroundColor = 'var(--table-selection-background-color, Highlight)';\n                    cellElement.style.color = 'var(--table-selection-color, HighlightText)';\n                }\n            });\n        }\n    }\n\n    protected deselect(): void {\n        if (this.range && this.range.cells) {\n            this.range.cells.forEach((cellElement) => {\n                if (this.config.selectionCssMode === 'cssClass' && this.config.selectionCssClass) {\n                    cellElement.classList.remove(this.config.selectionCssClass);\n                } else {\n                    cellElement.style.removeProperty('background-color');\n                    cellElement.style.removeProperty('color');\n                }\n            });\n            this.range = null;\n        }\n    }\n\n    protected copyToClipboard(e: ClipboardEvent): void {\n        if (! this.range || ! this.range.rows || ! e.clipboardData) {\n            return;\n        }\n\n        const selectionText = (this.range.rows as HTMLTableCellElement[][])\n            .map((row) => row.map((cell) => cell.innerText).join('\\t'))\n            .join('\\r\\n');\n\n        if (! selectionText) {\n            return;\n        }\n\n        e.clipboardData.setData('text/plain', selectionText);\n        e.preventDefault();\n    }\n\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","config","selector","selectionCssMode","selectionCssClass","range","this","styles","document","createElement","innerHTML","head","appendChild","addEventListener","onSelectionChange","e","copyToClipboard","selection","getSelection","deselect","isCollapsed","startCell","getCellElementFromNode","anchorNode","endCell","focusNode","startTableElements","getTableElementsFromCellElement","endTableElements","table","elements","getRangeByStartAndEndElement","getRowElements","getRowsAndCells","select","startCellElement","endCellElement","startRowElement","parentElement","endRowElement","start","row","rowIndex","cell","cellIndex","end","rowElements","rows","cells","numTableHeaders","querySelectorAll","length","theadRows","tbodyRows","theadStart","Math","min","theadEnd","tbodyStart","max","tbodyEnd","Array","from","forEach","i","cellsInRow","join","inputNode","element","nodeName","includes","tagName","cellElement","tHeadOrBody","matches","thead","querySelector","tbody","classList","add","style","backgroundColor","color","remove","removeProperty","clipboardData","selectionText","map","innerText","setData","preventDefault"],"sourceRoot":""}